<!DOCTYPE html>
<html lang="sv">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Prob Model Test</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        margin: 20px;
        color: #1b1f23;
      }
      .row {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 12px;
      }
      .card {
        border: 1px solid #e1e4e8;
        border-radius: 8px;
        padding: 12px;
      }
      input,
      select,
      button {
        padding: 8px;
      }
      pre {
        background: #f6f8fa;
        padding: 12px;
        border-radius: 6px;
      }
    </style>
  </head>
  <body>
    <h2>Prob Model Test</h2>
    <div class="card">
      <div class="row">
        <div>
          <label>Symbol</label>
          <input id="symbol" value="tBTCUSD" />
        </div>
        <div>
          <label>Timeframe</label>
          <select id="tf">
            <option>1m</option>
            <option>5m</option>
            <option>15m</option>
          </select>
        </div>
        <div>
          <label>Horizon (candles)</label>
          <input id="horizon" type="number" value="20" />
        </div>
      </div>
      <div class="row" style="margin-top: 8px">
        <div>
          <label>TP (dec)</label>
          <input id="tp" type="number" step="0.0001" value="0.002" />
        </div>
        <div>
          <label>SL (dec)</label>
          <input id="sl" type="number" step="0.0001" value="0.002" />
        </div>
        <div>
          <label>Fees (dec)</label>
          <input id="fees" type="number" step="0.0001" value="0.0003" />
        </div>
      </div>
      <div style="margin-top: 8px">
        <button id="inferBtn">Infer (live)</button>
      </div>
      <pre id="out">{}</pre>
    </div>
    <script>
      async function rest(path, options = {}) {
        const res = await fetch(`/api/v2${path}`, {
          method: options.method || "GET",
          headers: { "Content-Type": "application/json" },
          body: options.body ? JSON.stringify(options.body) : undefined,
        });
        if (!res.ok) throw new Error(await res.text());
        return res.json();
      }
      document
        .getElementById("inferBtn")
        .addEventListener("click", async () => {
          try {
            const symbol = document.getElementById("symbol").value.trim();
            const timeframe = document.getElementById("tf").value;
            const horizon = parseInt(
              document.getElementById("horizon").value || "20",
              10
            );
            const tp = parseFloat(document.getElementById("tp").value || "0");
            const sl = parseFloat(document.getElementById("sl").value || "0");
            const fees = parseFloat(
              document.getElementById("fees").value || "0"
            );
            const payload = { symbol, timeframe, horizon, tp, sl, fees };
            const data = await rest("/prob/predict", {
              method: "POST",
              body: payload,
            });
            document.getElementById("out").textContent = JSON.stringify(
              data,
              null,
              2
            );
          } catch (e) {
            document.getElementById("out").textContent = JSON.stringify(
              { error: e.message },
              null,
              2
            );
          }
        });
    </script>
  </body>
</html>
