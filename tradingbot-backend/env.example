# ============================
# TradingBot Backend Environment Variables (.env.example)
# ============================
# Detta är en mall. Kopiera till .env och fyll i egna värden.
# Rader som börjar med # är kommentarer och ignoreras av programmet.
# Booleska värden ska vara True/False (versaler).

# --- Server ---
HOST=0.0.0.0                       # IP/värd där API-servern lyssnar
PORT=8000                          # Port för API-servern
DEBUG=True                         # True = utvecklingsläge (mer logg/trace)
LOG_LEVEL=INFO                     # DEBUG, INFO, WARNING, ERROR
LOG_FILE=tradingbot.log            # Filnamn för logg (roteras externt om behövs)
VITE_API_BASE=http://127.0.0.1:8000 # Frontendens bas-URL till API:et

# --- CORS ---
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080,http://localhost:5173,http://127.0.0.1:5173,http://127.0.0.1:5174 # Tillåtna frontend-origins (komma-separerade)

# --- Bitfinex REST API (order, konto) ---
BITFINEX_API_KEY=                  # API-nyckel för autentiserade REST-anrop
BITFINEX_API_SECRET=               # Hemlighet tillhörande API-nyckeln
BITFINEX_AUTH_API_URL=https://api.bitfinex.com/v2    # Autentiserad REST-bas
BITFINEX_PUBLIC_API_URL=https://api-pub.bitfinex.com/v2  # Publik REST-bas (market data)

# --- Bitfinex WebSocket API (realtidsdata, autentisering) ---
BITFINEX_WS_API_KEY=               # WS-nyckel (för auth-kanaler)
BITFINEX_WS_API_SECRET=            # WS-hemlighet
BITFINEX_WS_AUTH_URI=wss://api.bitfinex.com/ws/2      # Autentiserad WS-URL
BITFINEX_WS_PUBLIC_URI=wss://api-pub.bitfinex.com/ws/2 # Publik WS-URL (tickers/kapacitet)

# --- JWT Autentisering ---
AUTH_REQUIRED=False                # True = API kräver JWT för skyddade endpoints
JWT_SECRET_KEY=your_jwt_secret_key_here  # Hemlig nyckel för att signera JWT
JWT_ALGORITHM=HS256                # Signeringsalgoritm
ACCESS_TOKEN_EXPIRE_MINUTES=30     # JWT-livslängd (minuter)
SOCKETIO_JWT_SECRET=socket-io-secret-key # Hemlighet för WS/Socket.IO‑token (bör matcha JWT_SECRET_KEY när AUTH_REQUIRED=True)

# --- GitHub (valfritt, för CI/CD, releaser, etc.) ---
GITHUB_TOKEN=                      # GitHub App/Token
GITHUB_PAT=                        # Personal Access Token (om du använder det)

# --- Notifieringar (valfritt, ex. Telegram) ---
# TELEGRAM_BOT_TOKEN=              # Bot-token om du vill få larm/notiser
# TELEGRAM_CHAT_ID=                # Chat ID att skicka till

# --- Rate Limit (valfritt, API-gateway-limiter) ---
# RATE_LIMIT_WINDOW_SECONDS=60     # Tidsfönster i sekunder
# RATE_LIMIT_MAX_REQUESTS=120      # Max antal requests i fönstret

# --- Databas ---
DATABASE_URL=sqlite:///./tradingbot.db  # SQLAlchemy URL (SQLite som default)

# --- Tradingkonfiguration (grundbeteenden) ---
DEFAULT_TRADING_PAIR=BTCUSD        # Standard-symbol/par
MAX_POSITION_SIZE=0.01             # Max positionsstorlek (enhet beror på par)
RISK_PERCENTAGE=2.0                # Risk per trade i procent av konto/quote
TIMEZONE=UTC                       # Systemets tidszon (för scheman/logik)
TRADING_RULES_FILE=config/trading_rules.json  # Regelfil (filters, blocklist, etc.)
MAX_TRADES_PER_DAY=30              # Hårda tak för antal trades per dag
MAX_TRADES_PER_SYMBOL_PER_DAY=10   # Per symbol per dag
TRADE_COOLDOWN_SECONDS=30          # Cooldown mellan trades (sekunder)
TRADING_PAUSED=False               # True = global paus (ingen exekvering)
DRY_RUN_ENABLED=False              # True = simulera (ingen riktig order läggs)

# --- Metrics / Monitoring (skydd för /metrics) ---
METRICS_ACCESS_TOKEN=              # Bearer-token för att skydda metrics-endpoint
METRICS_BASIC_AUTH_USER=metrics    # Användare för Basic Auth (om du väljer det)
METRICS_BASIC_AUTH_PASS=           # Lösenord för Basic Auth
# METRICS_IP_ALLOWLIST=127.0.0.1   # (valfritt) Begränsa metrics till vissa IP

# --- Data & Order Retry Settings (robusthet) ---
BITFINEX_API_URL=https://api-pub.bitfinex.com/v2  # Bas-URL för publika data
DATA_MAX_RETRIES=2                 # Max antal omförsök för datahämtning
DATA_BACKOFF_BASE_MS=300           # Backoff-början (ms) vid fel
DATA_BACKOFF_MAX_MS=200            # Backoff-tak (ms)
DATA_HTTP_TIMEOUT=6.0              # Timeout för HTTP-anrop (sek)
ORDER_MAX_RETRIES=1                # Omförsök vid orderfel (0/1/2 … försiktigt)

# --- WebSocket Inställningar (anslutning/beläggning) ---
WS_CONNECT_ON_START=True           # Autokonnekta WS vid start
WS_USE_POOL=True                   # Poola flera WS-klienter för att skala subs
WS_PUBLIC_SOCKETS_MAX=1            # Max parallella publika WS-klienter (Bitfinex konto‑limit)
WS_MAX_SUBS_PER_SOCKET=25          # Max subs per socket (Bitfinex: 25 kanaler/anslutning)

# --- WS/REST samspel (minska REST-storm) ---
WS_TICKER_WARMUP_MS=400            # Vänta innan REST fallback (ms) så WS hinner starta
WS_TICKER_STALE_SECS=10            # Hur länge WS-data anses färsk (sek)
TICKER_CACHE_TTL_SECS=30           # Cache-ttl för tickers (sek)

# --- Symboler ---
# Paper trading (testsymboler; byt vid live)
WS_SUBSCRIBE_SYMBOLS=tTESTADA:TESTUSD,tTESTALGO:TESTUSD,tTESTAPT:TESTUSD,tTESTAVAX:TESTUSD,tTESTBTC:TESTUSD,tTESTBTC:TESTUSDT,tTESTDOGE:TESTUSD,tTESTDOT:TESTUSD,tTESTEOS:TESTUSD,tTESTETH:TESTUSD,tTESTFIL:TESTUSD,tTESTLTC:TESTUSD,tTESTNEAR:TESTUSD,tTESTSOL:TESTUSD,tTESTXAUT:TESTUSD,tTESTXTZ:TESTUSD
# Live-exempel (avkommentera vid live-trading)
# WS_SUBSCRIBE_SYMBOLS=tADAUSD,tAPTUSD,tBTCUSD,tBTCUST,tDOTUSD,tETHUSD,tFILUSD,tLTCUSD,tSOLUSD,tXTZUSD
WS_CANDLE_TIMEFRAMES=1m,5m         # Timeframes att prenumerera på via WS‑candles

# --- Concurrency Caps (samtidiga REST-anrop) ---
PUBLIC_REST_CONCURRENCY=4          # Global cap för publika REST (candles, tickers)
PRIVATE_REST_CONCURRENCY=2         # Global cap för privata REST (wallets, positions, history)

# --- Probability Model (AI-beslutslogik) ---
PROB_MODEL_ENABLED=False           # True = använd AI-sannolikhetsmodell, False = heuristik
PROB_MODEL_FILE=config/models/BTCUSD_15m.json  # Modellfil (per symbol/timeframe)
PROB_MODEL_CONFIDENCE_MIN=0.10     # Min confidence (0..1) för att godkänna signal
PROB_MODEL_EV_THRESHOLD=0.0005     # Min förväntad avkastning (EV), decimal ROI eller %
PROB_MODEL_TIME_HORIZON=20         # Antal candles framåt beslutet gäller

# --- Probability Validation (rolling metrics) ---
PROB_VALIDATE_ENABLED=False        # True = kör schemalagd validering (Brier/LogLoss)
PROB_VALIDATE_INTERVAL_MINUTES=60  # Intervall mellan valideringar (minuter)
# PROB_VALIDATE_SYMBOLS=tBTCUSD,tETHUSD  # Lämna tomt för att använda WS_SUBSCRIBE_SYMBOLS
PROB_VALIDATE_TIMEFRAME=1m         # Timeframe som testas (ex: 1m, 5m, 15m, 1h)
PROB_VALIDATE_LIMIT=1200           # Historiska candles att hämta per körning
PROB_VALIDATE_MAX_SAMPLES=500      # Max samples att beräkna per körning
PROB_VALIDATE_WINDOWS_MINUTES=     # Ex: 60,360,1440 för flera fönster
PROB_VALIDATE_HISTORY_MAX_POINTS=1000         # Max datapunkter per fönster i minnet

# --- Probability Retraining (automatisk retraining/export) ---
PROB_RETRAIN_ENABLED=False         # True = träna om och exportera modeller schemalagt
PROB_RETRAIN_INTERVAL_HOURS=24     # Intervall mellan retraining-körningar (timmar)
# PROB_RETRAIN_SYMBOLS=tBTCUSD     # Lämna tomt: använd WS_SUBSCRIBE_SYMBOLS
PROB_RETRAIN_TIMEFRAME=15m         # Timeframe att träna på
PROB_RETRAIN_LIMIT=5000            # Antal candles att hämta för träning
PROB_RETRAIN_OUTPUT_DIR=config/models  # Sökväg för exporterade modellfiler

# --- Probability Auto Trading & Sizing (risk/position) ---
PROB_AUTOTRADE_ENABLED=False       # True = låt modellen trigga auto-order
PROB_SIZE_MAX_RISK_PCT=2.0         # Max risk per trade (%) vid sizing
PROB_SIZE_KELLY_CAP=0.5            # Kelly-fraktionens tak (0..1) för att dämpa risk
PROB_SIZE_CONF_WEIGHT=0.5          # Hur mycket confidence påverkar storleksberäkning (0..1)
POSITION_SIZE_FALLBACK_QUOTE=1000  # Reserv-belopp (quote) om sizing ej kan beräknas

# --- Bitfinex API Rate Limiting (vänligt mot API:t) ---
BITFINEX_RATE_LIMIT_ENABLED=True   # True = lokalt rate-limit-skydd
BITFINEX_RATE_LIMIT_REQUESTS_PER_MINUTE=10   # Konservativ rpm lokalt (offentliga endpoints)
BITFINEX_RATE_LIMIT_BURST_SIZE=1   # Undvik bursts för att minska 429/503
BITFINEX_RATE_LIMIT_WINDOW_SECONDS=60  # Fönsterstorlek (sek)
BITFINEX_SERVER_BUSY_BACKOFF_MIN_SECONDS=15.0  # Backoff-min vid "server busy"/429/503
BITFINEX_SERVER_BUSY_BACKOFF_MAX_SECONDS=60.0  # Backoff-max (respekterar Retry-After om satt)

# --- Acceptance-mått (för dashboard badge) ---
ACCEPT_CANDLES_P95_MS_MAX=500      # Max tillåten p95-latens (ms) för candle-anrop
ACCEPT_CANDLES_P99_MS_MAX=1200     # Max tillåten p99-latens (ms)
ACCEPT_MAX_429_PER_HOUR=1          # Max 429/h under normal drift
ACCEPT_MAX_503_PER_HOUR=1          # Max 503/h under normal drift
